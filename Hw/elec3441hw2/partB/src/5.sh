#!/usr/bin/sh
exec > 'dc.csv'

benchmarks='bfs_matrix bfs_pointer conv2D fir kmean mm quicksort sobel' #conv2D fir kmean mm quicksort sobel'
dcs='256:1:16 512:1:16 1024:1:16 2048:1:16 4096:1:16 8192:1:16 16384:1:16 32768:1:16 65536:1:16 131072:1:16 128:1:32 256:1:32 512:1:32 1024:1:32 2048:1:32 4096:1:32 8192:1:32 16384:1:32 32768:1:32 65536:1:32 128:2:16 256:2:16 512:2:16 1024:2:16 2048:2:16 4096:2:16 8192:2:16 16384:2:16 32768:2:16 65536:2:16 64:2:32 128:2:32 256:2:32 512:2:32 1024:2:32 2048:2:32 4096:2:32 8192:2:32 16384:2:32 32768:2:32 64:4:16 128:4:16 256:4:16 512:4:16 1024:4:16 2048:4:16 4096:4:16 8192:4:16 16384:4:16 32768:4:16 32:4:32 64:4:32 128:4:32 256:4:32 512:4:32 1024:4:32 2048:4:32 4096:4:32 8192:4:32 16384:4:32 32:8:16 64:8:16 128:8:16 256:8:16 512:8:16 1024:8:16 2048:8:16 4096:8:16 8192:8:16 16384:8:16 16:8:32 32:8:32 64:8:32 128:8:32 256:8:32 512:8:32 1024:8:32 2048:8:32 4096:8:32 8192:8:32 16:16:16 32:16:16 64:16:16 128:16:16 256:16:16 512:16:16 1024:16:16 2048:16:16 4096:16:16 8192:16:16 8:16:32 16:16:32 32:16:32 64:16:32 128:16:32 256:16:32 512:16:32 1024:16:32 2048:16:32 4096:16:32 8:32:16 16:32:16 32:32:16 64:32:16 128:32:16 256:32:16 512:32:16 1024:32:16 2048:32:16 4096:32:16 4:32:32 8:32:32 16:32:32 32:32:32 64:32:32 128:32:32 256:32:32 512:32:32 1024:32:32 2048:32:32'
cols='-8'

echo 'Benchmark,Data Cache,D$ Bytes Read,D$ Bytes Written,D$ Read Accesses,D$ Write Accesses,D$ Read Misses,D$ Write Misses,D$ Writebacks,D$ Miss Rate'
for dc in $dcs; do
    for benchmark in $benchmarks; do
        echo -n "${benchmark},${dc},"
        spike --dc=$dc pk ./$benchmark/$benchmark \
            | tail $cols | awk '{print $NF}' | sed -z 's/\n/,/g;s/,$/\n/'
    done
done
